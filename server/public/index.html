<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
    .form-control {
      width: 100%;
    }

    .text-area {
      height: 60px;
    }

    .flex {
      display: flex;
      /*box-sizing: border-box;*/
    }

    .flex > div {
      flex-basis: 30%;
      margin-right: 5px;
    }

    #room_name {
      
    }

    #custom_name {

    }
  </style>
</head>
<body>
  <div class="flex">
    <div>
      <select id="room_name" class="form-control">
        <option value ="126733">nvliu | 女流</option>
        <option value ="fengtimo">fengtimo | 冯提莫</option>
        <option value="xiaoqingmiao">xiaoqingmiao | 小青喵</option>
        <option value="chenyifa">chenyifa | 陈一发</option>
        <option value="155377">155377 | 夏天蓝海</option>
      </select>
    </div>
    <div>
      <input id="custom_name" class="form-control" type="text" placeholder="custom room id" />
    </div>
  </div>
  <div>
    <textarea id="message_area" class="form-control text-area" placeholder="input token..."></textarea>
  </div>
  <button id="ok_button" class="form-control">Send</button>
  
  <div>
    <div>Response: </div>
    <div id="response"></div>
  </div>
  <div>
    <div>Receive Message: </div>
    <div id="recv_message">
    </div>
  </div>


  <script type="text/javascript">
    function broadcast(oData) {
      var path = "/api/_all";
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function(){
        if (this.readyState==4)
        {
          // this.status==200
          //console.log(this);
          //console.log(arguments);
          var s = "<p>" + this.status + "|" + this.statusText + "</p>" +
                  "<p>" + this.responseText + "</p>";

          document.getElementById("response").innerHTML = s;
        }
      };
      
      xmlhttp.open("POST", path, true);
      //xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
      xmlhttp.setRequestHeader("Content-type","application/json");
      xmlhttp.send(JSON.stringify(oData));
    }

    function parseToken(s){
      if (-1 === s.indexOf('\n')) {
        return s;
      }

      var aToken = s.split('\n');
      var sToken = aToken.map(function(line){
        var aColumn = line.split(':');
        return aColumn[0].trim() + '=' + aColumn[1].trim();
      }).join('&');
      return sToken;
      // tt:24869738
      // cdn:ws
      // rate:2
      // did:9C9B29EE0C9EA895F06C92FDADC800ED
      // sign:a154d5b630054a9c0d118bb6d9097c23
      // ver:2017041401
    }

    window.onload = function() {
      var elButton = document.getElementById("ok_button");
      var elMessageArea = document.getElementById("message_area");
      var elRoomName = document.getElementById("room_name");
      var elCustomRoomName = document.getElementById("custom_name");

      elButton.addEventListener('click', function(){
        var oData = {
          roomId: elCustomRoomName.value != "" ? elCustomRoomName.value : elRoomName.value,
          body: parseToken(elMessageArea.value)
        };
        broadcast(oData);
      });
    };
  </script>
</body>
</html>
